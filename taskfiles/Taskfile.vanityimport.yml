# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

vars:
  VANITYIMPORT_BIN: 'vanityimport{{exeExt}}'
  VANITYIMPORT_CMD: '{{.BIN_INSTALL_DIR}}/{{.VANITYIMPORT_BIN}}'

tasks:
  check:deps:
    desc: Ensure vanityimport CLI is built
    status:
      - test -f "{{.VANITYIMPORT_CMD}}"
    cmds:
      - mkdir -p "{{.BIN_INSTALL_DIR}}"
      - go build -o "{{.VANITYIMPORT_CMD}}" ./cmd/vanityimport

  default:
    desc: Show available vanity import commands
    cmds:
      - task --list-all | grep vanityimport

  list:
    desc: List all packages
    deps: [check:deps]
    cmds:
      - "{{.VANITYIMPORT_CMD}} list"

  info:
    desc: Show package information
    deps: [check:deps]
    cmds:
      - "{{.VANITYIMPORT_CMD}} info {{.NAME}}"
    requires:
      vars: [NAME]

  add:
    desc: Add a new package
    deps: [check:deps]
    cmds:
      - |
        {{.VANITYIMPORT_CMD}} add {{.NAME}} \
          {{if .REPO}}--repo "{{.REPO}}"{{end}} \
          {{if .DESCRIPTION}}--description "{{.DESCRIPTION}}"{{end}} \
          {{if .VERSION}}--version "{{.VERSION}}"{{end}}
    requires:
      vars: [NAME]

  update:
    desc: Update package metadata from GitHub
    deps: [check:deps]
    cmds:
      - "{{.VANITYIMPORT_CMD}} update {{.NAME | default \"\"}}"

  update:all:
    desc: Update all packages from GitHub
    deps: [check:deps]
    cmds:
      - "{{.VANITYIMPORT_CMD}} update"

  docs:
    desc: Generate markdown docs for a package
    deps: [check:deps]
    cmds:
      - "{{.VANITYIMPORT_CMD}} docs {{.NAME}} {{if .OUTPUT}}-o {{.OUTPUT}}{{end}}"
    requires:
      vars: [NAME]

  docs:save:
    desc: Generate and save docs to content directory
    deps: [check:deps]
    cmds:
      - "{{.VANITYIMPORT_CMD}} docs {{.NAME}} -o content/english/pkg/{{.NAME}}.md"
    requires:
      vars: [NAME]

  packages:
    desc: "[alias] List all packages"
    deps: [list]

  help:
    desc: Show vanityimport CLI help
    deps: [check:deps]
    cmds:
      - "{{.VANITYIMPORT_CMD}} --help"
