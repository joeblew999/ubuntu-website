# Genlogo Tasks
#
# Logo and branding asset generation via cmd/genlogo.
#
# Lifecycle:
#   task genlogo:check:deps       - Ensure binary is available
#   task genlogo:generate:all     - Generate all branding assets
#   task genlogo:generate:favicon - Generate favicon only

version: '3'

vars:
  GENLOGO_BIN: 'genlogo{{exeExt}}'
  GENLOGO_CMD: '{{.BIN_INSTALL_DIR}}/{{.GENLOGO_BIN}}'

tasks:
  # ===========================================================================
  # Checks (check:* - lifecycle phase)
  # ===========================================================================

  check:deps:
    desc: Ensure genlogo binary is available
    status:
      - test -f "{{.GENLOGO_CMD}}"
    cmds:
      - mkdir -p "{{.BIN_INSTALL_DIR}}"
      - go build -o "{{.GENLOGO_CMD}}" ./cmd/genlogo

  # ===========================================================================
  # Generate (generate:* - lifecycle phase)
  # ===========================================================================
  # Uses Task's sources/generates for idempotency - skips if unchanged

  generate:all:
    desc: Generate all branding assets (favicon, logos, og-image, email-logo, avatar, banner)
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/assets/images/favicon.png'
      - '{{.ROOT_DIR}}/assets/images/logo.svg'
      - '{{.ROOT_DIR}}/assets/images/logo-darkmode.svg'
      - '{{.ROOT_DIR}}/static/images/og-image.png'
      - '{{.ROOT_DIR}}/static/images/email-logo.png'
      - '{{.ROOT_DIR}}/static/images/bluesky-avatar.png'
      - '{{.ROOT_DIR}}/static/images/bluesky-banner.png'
    cmds:
      - '{{.GENLOGO_CMD}} -asset all -dir "{{toSlash .ROOT_DIR}}"'
      - echo ""
      - 'echo "Assets generated. Next steps:"'
      - echo "  1. Deploy website (git push) - updates Hugo site with new favicon, logos, og-image"
      - 'echo "  2. Gmail signature - re-upload email-logo.png at https://mail.google.com/mail/u/0/#settings/general"'
      - 'echo "  3. Bluesky profile - re-upload avatar & banner at https://bsky.app/profile/ubuntusoftware.net"'

  generate:favicon:
    desc: Generate favicon only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/assets/images/favicon.png'
    cmds:
      - '{{.GENLOGO_CMD}} -asset favicon -dir "{{toSlash .ROOT_DIR}}"'

  generate:logo:
    desc: Generate logo SVGs only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/assets/images/logo.svg'
      - '{{.ROOT_DIR}}/assets/images/logo-darkmode.svg'
    cmds:
      - '{{.GENLOGO_CMD}} -asset logo-svg -dir "{{toSlash .ROOT_DIR}}"'

  generate:og-image:
    desc: Generate Open Graph image only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/static/images/og-image.png'
    cmds:
      - '{{.GENLOGO_CMD}} -asset og -dir "{{toSlash .ROOT_DIR}}"'

  generate:avatar:
    desc: Generate avatar only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/static/images/bluesky-avatar.png'
    cmds:
      - '{{.GENLOGO_CMD}} -asset avatar -dir "{{toSlash .ROOT_DIR}}"'

  generate:banner:
    desc: Generate banner only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/static/images/bluesky-banner.png'
    cmds:
      - '{{.GENLOGO_CMD}} -asset banner -dir "{{toSlash .ROOT_DIR}}"'

  # ===========================================================================
  # Release (release:* - build for distribution)
  # ===========================================================================

  release:build:
    desc: Build genlogo for release (current platform, or set GOOS/GOARCH)
    cmds:
      - mkdir -p "{{.ROOT_DIR}}/{{.DIR_BUILD}}"
      - go build -o "{{.ROOT_DIR}}/{{.DIR_BUILD}}/{{.GENLOGO_BIN}}" ./cmd/genlogo

  release:test:
    desc: Test built genlogo release binary
    cmds:
      - "{{.ROOT_DIR}}/{{.DIR_BUILD}}/{{.GENLOGO_BIN}} -h || true"
