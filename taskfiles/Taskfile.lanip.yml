# LAN IP Tasks
#
# Cross-platform LAN IP detection using Go.
# Works on macOS, Linux, Windows.
#
# REQUIRES: go (for go run ./cmd/lanip)

version: '3'

tasks:
  # ===========================================================================
  # Checks (check:* - diagnostics for this module)
  # ===========================================================================
  # deps     - ensure required tools are installed
  # validate - smoke test, runs in CI on change
  # health   - external system check (network reachability)

  check:deps:
    desc: Ensure Go is installed (required for lanip)
    cmds:
      - |
        if command -v go >/dev/null 2>&1; then
          echo "OK: go is installed ($(go version | cut -d' ' -f3))"
        else
          echo "ERROR: go is not installed"
          echo ""
          echo "Install Go:"
          echo "  macOS:   brew install go"
          echo "  Linux:   sudo apt install golang-go"
          echo "  Windows: choco install golang"
          echo "  Or:      https://go.dev/dl/"
          exit 1
        fi

  check:validate:
    desc: Smoke test lanip module works
    cmds:
      - |
        echo "Validating lanip module..."
        LAN_IP=$(go run ./cmd/lanip 2>&1)
        if [ $? -ne 0 ]; then
          echo "lanip:check:validate FAILED: $LAN_IP"
          exit 1
        fi
        echo "LAN IP: $LAN_IP"
        echo "lanip:check:validate passed"

  check:health:
    desc: Check network connectivity (can reach external DNS)
    cmds:
      - |
        echo "Checking network health..."
        LAN_IP=$(go run ./cmd/lanip 2>&1)
        if [ $? -ne 0 ] || [ -z "$LAN_IP" ]; then
          echo "lanip:check:health FAILED: No LAN IP detected"
          exit 1
        fi
        echo "LAN IP: $LAN_IP"
        echo "lanip:check:health passed"

  # ===========================================================================
  # Tasks
  # ===========================================================================

  get:
    desc: Get LAN IP address
    cmds:
      - go run ./cmd/lanip
