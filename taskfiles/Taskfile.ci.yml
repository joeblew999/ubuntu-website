# CI Tasks
#
# Tasks that are called by GitHub Actions workflows.
# Each ci:<name> task should have a matching .github/workflows/<name>.yml
#
# Validation: Run `task ci:validate` to check bindings

version: '3'

tasks:
  taskfile:
    desc: Validate Taskfile works (used by CI matrix)
    cmds:
      - |
        echo "## Taskfile Validation"
        echo ""
        echo "OS: $(uname -s 2>/dev/null || echo Windows)"
        echo ""

      # Validate all included modules (check:validate pattern)
      - echo "### Module Validation"
      - task: :git:check:validate

      - |
        echo ""
        echo "### Include Test"
        echo "This task is loaded from: taskfiles/Taskfile.ci.yml"
        echo ""
        echo "### Variable Expansion Test"
        echo "PROJECT_NAME: {{.PROJECT_NAME}}"
        echo "DOMAIN: {{.DOMAIN}}"
        echo ""
        echo "Taskfile validated successfully"

  health:
    desc: Run all health checks (used by scheduled CI)
    cmds:
      - |
        echo "## Health Check"
        echo ""
        echo "Time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo ""

      - echo "### Module Health Checks"
      - task: :git:check:health

      # Add more health checks as modules are added:
      # - task: :hugo:check:health
      # - task: :cf:check:health

      - |
        echo ""
        echo "All health checks passed"

  health:test-fail:
    desc: "[TEST] Force health check failure to test notifications"
    cmds:
      - |
        echo "## Health Check (TEST FAILURE)"
        echo ""
        echo "Time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo ""
        echo "This is an intentional failure to test the notification system."
        echo ""

      - task: :git:check:health:fail
