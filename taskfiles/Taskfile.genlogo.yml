# Genlogo Tasks
#
# Logo and branding asset generation via cmd/genlogo.
# Uses xplat binary:install for cross-platform binary management.
#
# Lifecycle:
#   task genlogo:check:deps       - Ensure binary is available
#   task genlogo:generate:all     - Generate all branding assets
#   task genlogo:generate:favicon - Generate favicon only
#
# REQUIRES: xplat (for binary management)

version: '3'

vars:
  # GENLOGO_VERSION comes from versions.env (loaded by root Taskfile dotenv)
  GENLOGO_REPO: joeblew999/ubuntu-website
  GENLOGO_BIN: 'genlogo{{exeExt}}'
  GENLOGO_INSTALL_DIR: '{{if eq OS "windows"}}{{.HOME}}/bin{{else}}{{.HOME}}/.local/bin{{end}}'

tasks:
  # ===========================================================================
  # Checks (check:* - lifecycle phase)
  # ===========================================================================

  check:deps:
    desc: Ensure genlogo binary is available (builds from source or downloads)
    # status: provides true idempotency - skips entirely if binary exists
    status:
      - test -f "{{.GENLOGO_INSTALL_DIR}}/{{.GENLOGO_BIN}}"
    cmds:
      # toSlash converts backslashes to forward slashes for shell compatibility on Windows
      - '{{.XPLAT_BIN}} binary install genlogo {{.GENLOGO_VERSION}} {{.GENLOGO_REPO}} --source "{{toSlash .ROOT_DIR}}/cmd/genlogo"'

  # ===========================================================================
  # Generate (generate:* - lifecycle phase)
  # ===========================================================================
  # Uses Task's sources/generates for idempotency - skips if unchanged

  generate:all:
    desc: Generate all branding assets (favicon, logos, og-image, email-logo, avatar, banner)
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/assets/images/favicon.png'
      - '{{.ROOT_DIR}}/assets/images/logo.svg'
      - '{{.ROOT_DIR}}/assets/images/logo-darkmode.svg'
      - '{{.ROOT_DIR}}/static/images/og-image.png'
      - '{{.ROOT_DIR}}/static/images/email-logo.png'
      - '{{.ROOT_DIR}}/static/images/bluesky-avatar.png'
      - '{{.ROOT_DIR}}/static/images/bluesky-banner.png'
    cmds:
      # toSlash converts backslashes to forward slashes for shell compatibility on Windows
      - '{{.GENLOGO_INSTALL_DIR}}/genlogo{{exeExt}} -asset all -dir "{{toSlash .ROOT_DIR}}"'
      - echo ""
      - echo "Assets generated. Next steps:"
      - echo "  1. Deploy website (git push) - updates Hugo site with new favicon, logos, og-image"
      - echo "  2. Gmail signature - re-upload email-logo.png at https://mail.google.com/mail/u/0/#settings/general"
      - echo "  3. Bluesky profile - re-upload avatar & banner at https://bsky.app/profile/ubuntusoftware.net"

  generate:favicon:
    desc: Generate favicon only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/assets/images/favicon.png'
    cmds:
      - '{{.GENLOGO_INSTALL_DIR}}/genlogo{{exeExt}} -asset favicon -dir "{{toSlash .ROOT_DIR}}"'

  generate:logo:
    desc: Generate logo SVGs only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/assets/images/logo.svg'
      - '{{.ROOT_DIR}}/assets/images/logo-darkmode.svg'
    cmds:
      - '{{.GENLOGO_INSTALL_DIR}}/genlogo{{exeExt}} -asset logo-svg -dir "{{toSlash .ROOT_DIR}}"'

  generate:og-image:
    desc: Generate Open Graph image only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/static/images/og-image.png'
    cmds:
      - '{{.GENLOGO_INSTALL_DIR}}/genlogo{{exeExt}} -asset og -dir "{{toSlash .ROOT_DIR}}"'

  generate:avatar:
    desc: Generate avatar only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/static/images/bluesky-avatar.png'
    cmds:
      - '{{.GENLOGO_INSTALL_DIR}}/genlogo{{exeExt}} -asset avatar -dir "{{toSlash .ROOT_DIR}}"'

  generate:banner:
    desc: Generate banner only
    deps: [check:deps]
    sources:
      - '{{.ROOT_DIR}}/cmd/genlogo/**/*.go'
    generates:
      - '{{.ROOT_DIR}}/static/images/bluesky-banner.png'
    cmds:
      - '{{.GENLOGO_INSTALL_DIR}}/genlogo{{exeExt}} -asset banner -dir "{{toSlash .ROOT_DIR}}"'

  # ===========================================================================
  # Aliases (backwards compatibility)
  # ===========================================================================

  all:
    desc: "[alias] → genlogo:generate:all"
    cmds:
      - task: generate:all

  favicon:
    desc: "[alias] → genlogo:generate:favicon"
    cmds:
      - task: generate:favicon

  logo:
    desc: "[alias] → genlogo:generate:logo"
    cmds:
      - task: generate:logo

  og-image:
    desc: "[alias] → genlogo:generate:og-image"
    cmds:
      - task: generate:og-image

  avatar:
    desc: "[alias] → genlogo:generate:avatar"
    cmds:
      - task: generate:avatar

  banner:
    desc: "[alias] → genlogo:generate:banner"
    cmds:
      - task: generate:banner
