# Task-UI Tasks
#
# Web-based dashboard for executing Taskfile tasks.
# Source: github.com/joeblew999/xplat/cmd/task-ui
#
# Usage:
#   task tui:up             Start Task-UI at http://localhost:3000
#   task tui:down           Stop Task-UI (Ctrl+C)
#
# Documentation: https://github.com/titpetric/task-ui

version: '3'

vars:
  TUI_BIN: 'task-ui{{exeExt}}'
  TUI_CMD: '{{.BIN_INSTALL_DIR}}/{{.TUI_BIN}}'
  TUI_PORT: '3000'
  # xplat is the source of truth for task-ui
  XPLAT_DIR: '{{.ROOT_DIR}}/../xplat'

tasks:
  # ===========================================================================
  # Checks (check:* - lifecycle phase)
  # ===========================================================================

  check:deps:
    desc: Ensure task-ui binary is available (installs from xplat)
    internal: true
    status:
      - test -f "{{.BIN_INSTALL_DIR}}/{{.TUI_BIN}}"
    cmds:
      - mkdir -p "{{.BIN_INSTALL_DIR}}"
      - go install github.com/joeblew999/xplat/cmd/task-ui@latest
      - cp "$(go env GOPATH)/bin/{{.TUI_BIN}}" "{{.BIN_INSTALL_DIR}}/{{.TUI_BIN}}"

  # ===========================================================================
  # Core Commands (up/down)
  # ===========================================================================

  up:
    desc: Start Task-UI web dashboard at http://localhost:3000
    deps: [check:deps]
    cmds:
      - 'echo "Starting Task-UI at http://localhost:{{.TUI_PORT}}"'
      - 'echo "Press Ctrl+C to stop"'
      - 'echo ""'
      - '{{.TUI_CMD}} --history-enable'
